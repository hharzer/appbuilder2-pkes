<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>AppBuilder: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AppBuilder
   &#160;<span id="projectnumber">2.0rc1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AppBuilder Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="class_app_builder.html">AppBuilder</a> is a library that's designed to communicate with a compatible counterpart, e.g. a computer, an android phone or even another arduino handset.</p>
<p>Currently supported are the following functions:</p><ul>
<li>Connection detection (disconnction detection isn't currently supported due to restriction from arduino's serial library)</li>
<li>Handshake to ensure that you're connected to a compatible and trustworhty counterpart</li>
<li>Building layouts and sending them (You can nested layouts etc. The view, though, depends on your counterpart)</li>
<li>Setting, receiving and executing callback for both buttons and textinputs (the latter also receives the string that as inside the textinput)</li>
<li>Setting text</li>
</ul>
<p>There are several features still to be implemented like creating diagrams and sending data continously. The latter can be emulated by sending text.</p>
<h1>Usage</h1>
<p>The library was designed to be as straighforward as possible, so all names should be self-explanatory and easy to understand. Nonetheless, a tutorial on how to use the library will beneift your understanding.</p>
<h2>Getting started</h2>
<h3>Initializing</h3>
<p><a class="el" href="class_app_builder.html">AppBuilder</a>'s constructor is defined as follows:</p>
<div class="fragment"><div class="line"><a class="code" href="class_app_builder.html">AppBuilder</a>(byte num_com, byte num_callbacks, String handshake, <span class="keywordtype">int</span> attempts);</div>
</div><!-- fragment --><p>The arguments explained:</p><ul>
<li><code>num_com</code> is the <em>number of components</em> you want to use</li>
<li><code>num_callbacks</code> is the <em>number of callbacks</em> you want to use</li>
<li><code>handshake</code> is the <em>handshake phrase</em> that's used to connect to a counterpart</li>
<li><code>attempts</code> is the <em>number of attempts</em> made at doing a handshake</li>
</ul>
<p>An exmaple for initializing your <a class="el" href="class_app_builder.html">AppBuilder</a> object would look like this:</p>
<div class="fragment"><div class="line"><a class="code" href="class_app_builder.html">AppBuilder</a> appb(12, 5, String(<span class="stringliteral">&quot;AVH\0&quot;</span>), 2048);</div>
</div><!-- fragment --><p>You can store <em>12</em> components that have <em>5</em> callbacks. The connection phrase would be <em>AVH</em> (ArduinoVizHandshake) and the number for attempts <em>2048</em>.</p>
<p>Next thing you need would be a function that's called when you're connected. That's probably your first encounter with <code>gen_callback</code>. It will be explained later on.</p>
<p>The signature of <code>gen_callback</code> is defined as follows: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> void (*gen_callback)(uid8, <span class="keywordtype">char</span> *);</div>
</div><!-- fragment --><p>Since there's no uid or character array involved, you can safely ignore both arguments. When your function gets called, you'll be able to create your layout.</p>
<h3>Building a layout</h3>
<p>Currently, there are four different UI elements available:</p><ul>
<li>Layout</li>
<li>Label</li>
<li>Button</li>
<li>Text input</li>
</ul>
<p>The last two offer a callback functionality which will be explained later on. For now, though, we want to create an UI and send it to the counterpart.</p>
<p>First of all, we need a layout that acts as a container for the UI. The layout also specifies how all elements are sorted and arranged. However, the client organizes this for now. After we created a layout, we can add other components such as buttons and label. There's also the possibily of nesting layout to group and arrange them.</p>
<div class="fragment"><div class="line">uid8 l = appb.start_layout();</div>
<div class="line">t2 = appb.add_label();</div>
<div class="line">uid8 b3 = appb.add_button();</div>
<div class="line">uid8 b2 = appb.add_button();</div>
<div class="line">uid8 t1 = appb.add_input();</div>
<div class="line">uid8 b = appb.add_button();</div>
<div class="line">b4 = appb.add_label();</div>
<div class="line">appb.end_layout(l);</div>
</div><!-- fragment --><p>Since you want to change properties and add callbacks later, you need to save all uids of component you want to modify. All function that add components to the layout will return the uid of the created element if it was successfull, otherwise ( for example when you've already added the specified amount of components ) it will return 0.</p>
<p>Also, you probably noticed that, when you call <code>end_layout</code>, you have to pass a uid, namely the one of the layout you actually want to close.</p>
<p>After you created all components and saved all necessary uids, you can send them:</p>
<div class="fragment"><div class="line">appb.send_components();</div>
</div><!-- fragment --><h2>Setting properties</h2>
<h3>Setting the text of somehting</h3>
<p>To change the text of any component (except the layout, everyone has a caption), you simply need to call <code>set_text</code> and pass the uid and the text.</p>
<p>A call could look like this:</p>
<div class="fragment"><div class="line">appb.set_text(t2, <span class="stringliteral">&quot;Sample Text 1&quot;</span>);</div>
<div class="line">appb.set_text(b, <span class="stringliteral">&quot;on&quot;</span>);</div>
<div class="line">appb.set_text(b2, <span class="stringliteral">&quot;off&quot;</span>);</div>
<div class="line">appb.set_text(b3, <span class="stringliteral">&quot;Sample Text 2&quot;</span>);</div>
<div class="line">appb.set_text(b4, <span class="stringliteral">&quot;Sample Text 3&quot;</span>);</div>
</div><!-- fragment --><h2>Setting and receiving callbacks</h2>
<p>To be able to react to callbacks, you need to assign ceratin components certain function.</p>
<p>To set such a function, it is important to comply to <code>gen_callback</code>. The arguments are the id of the element that initiated the callback and a possible character array with the contents of an input. A function may look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> turn_on(uid8 <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *<span class="keywordtype">string</span>)</div>
<div class="line">{</div>
<div class="line">    digitalWrite(13, HIGH);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> turn_off(uid8 <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *<span class="keywordtype">string</span>)</div>
<div class="line">{</div>
<div class="line">    digitalWrite(13, LOW);</div>
<div class="line">}</div>
</div><!-- fragment --><p>As you probably noticed, this functions toggle the built-in led. we want to assign them to the buttons labeled <em>on</em> and <em>off</em>. Their ids are stored in <code>b</code> and <code>b2</code>.</p>
<div class="fragment"><div class="line">appb.add_callback(b, turn_on);</div>
<div class="line">appb.add_callback(b2, turn_off);</div>
</div><!-- fragment --><p>Now, when you click the corresponding buttons you'll notice that you can now turn the led on and off. A text callback would look similarly:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> text_callback(uid8 <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *<span class="keywordtype">string</span>)</div>
<div class="line">{</div>
<div class="line">    appb.set_text(b4, <span class="keywordtype">string</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Keep in mind that the passed string is only valid within your callback. It is possible that it gets invalidated after leaving the function.</p>
<div class="fragment"><div class="line">appb.add_callback(t1, text_callback);</div>
</div><!-- fragment --><h1>Callbacks explained</h1>
<p>You need to be aware of certain facts regarding callback handling. One of them was already mentioned above: strings are only valid wihtin the function. But there are other things you have to keep in mind.</p>
<h2>When to expect them</h2>
<p>Callbacks can only be recognized when you're arduino executes <code>serial_event</code>. Because of that, there's the possibility that callbacks get dropped if your computation take too long and you're sending too many callbacks from the client.</p>
<div class="image">
<img src="Callback_Ablauf.png" alt="Callback_Ablauf.png"/>
<div class="caption">
Callback cycle</div></div>
<p> The callback stack can hold up to <em>two</em> callbacks at the same time.</p>
<h1>General sequence of events</h1>
<div class="image">
<img src="Allgemeiner_Ablauf.png" alt="Allgemeiner_Ablauf.png"/>
<div class="caption">
General process</div></div>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Oct 26 2014 14:04:33 for AppBuilder by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
